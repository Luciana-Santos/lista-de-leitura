(()=>{"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,a,o){return a&&t(e.prototype,a),o&&t(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}var o=function(){function t(){e(this,t)}return a(t,null,[{key:"getBooks",value:function(){return null===localStorage.getItem("books")?[]:JSON.parse(localStorage.getItem("books"))}},{key:"addBook",value:function(e){var a=t.getBooks();a.push(e),localStorage.setItem("books",JSON.stringify(a))}},{key:"removeBook",value:function(e){var a=t.getBooks();a.forEach((function(t,o){+t.id==+e&&a.splice(o,1)})),localStorage.setItem("books",JSON.stringify(a))}},{key:"updateBook",value:function(e,a){var o=t.getBooks();o.forEach((function(t,n){t.id===e&&(o.splice(n,1),o.push(a)),localStorage.setItem("books",JSON.stringify(o))}))}}]),t}(),n=a((function t(a,o,n,r,c,l,i){e(this,t),this.id=a,this.cover=o,this.title=n,this.author=r,this.pagesTotal=c,this.pagesPerDay=l,this.prevision=i,this.completed=!1})),r="./assets/cover-undefined.png";function c(e,t){if(e<=0||t<=0)return"00/00/0000";var a,o=new Date,n=(a=e/t,Math.floor(24*a*60*60));return o.setSeconds(o.getSeconds()+n),o.toLocaleDateString("pt-BR")}function l(){document.querySelector("#title").value="",document.querySelector("#author").value="",document.querySelector("#totalPages").value="",document.querySelector("#pagesPerDay").value="";var e=document.querySelector("#cover"),t=document.querySelector(".fa-image"),a=document.querySelector('[data-image="preview"]');a&&a.remove(),document.querySelector('[data-from="prevision"]').innerText="00/00/0000",t.style.display="block",e.removeAttribute("disabled")}function i(e,t){return(e/t*100).toFixed()}var d,s,u,m,v,p,g,f,y,b,k,S=function(){function t(){e(this,t)}return a(t,null,[{key:"displayBooks",value:function(){o.getBooks().forEach((function(e){return t.addBookToList(e)}))}},{key:"addBookToList",value:function(e){var a=document.querySelector('[data-book="list"]'),o=document.createElement("article");o.setAttribute("id",e.id),o.classList.add("book_list__item"),o.innerHTML=function(e){return'\n  <div class="book_list__item__img">\n    <img src="'.concat(e.cover||r,'" alt="').concat(e.title,'">\n  </div>\n  <div class="book_list__item__info" data-book="info">\n    <h3>').concat(e.title,' <span class="book_id" data-book="bookId">#').concat(e.id,'</span></h3>\n    <p class="prevision" data-book="previsionDate">Previsão de término: <span>').concat(e.prevision,'</span></p>\n    <div class="progress">\n      <div class="progress__info">\n        <p class="pages"><span data-book="currPage">').concat(e.currPag||0,"\n          </span> páginas de ").concat(e.pagesTotal,'</p>\n        <p class="percentage" data-book="percentage">').concat(e.percentage||0,'%\n        </p>            \n      </div>\n      <div class="progress__bar">\n        <span data-book="progressBar"></span>\n      </div>\n    </div>  \n\n    <div class="book_list__item__btn" data-bookItem="btn">\n      ').concat(e.completed?'<p class="completed_book">Concluído</p>':'<button class="btn btn--red update" data-book="update">Atualizar</button>','\n      <i class="fa-solid fa-trash-can delete"></i>\n    </div>\n  </div>\n')}(e),o.dataset.book="item",a.insertAdjacentElement("afterbegin",o),t.updateProgressBar(e.id,e.percentage||0)}},{key:"getInputsValue",value:function(){var e,t=document.querySelector("#cover"),a=document.querySelector("#title").value,o=document.querySelector("#author").value,n=document.querySelector("#totalPages").value,r=document.querySelector("#pagesPerDay").value,l=null==t||null===(e=t.nextElementSibling)||void 0===e?void 0:e.attributes.src.nodeValue,i=c(n,r);return{id:Math.floor(9999999*Math.random()),imgBlob:l,inputTitleValue:a,inputAuthorValue:o,inputTotalPagesValue:n,inputPagesPerDayValue:r,datePrevision:i}}},{key:"addBookData",value:function(){var e=document.querySelector('[data-form="container"]'),a=t.getInputsValue(),r=a.id,c=a.imgBlob,i=a.inputTitleValue,d=a.inputAuthorValue,s=a.inputTotalPagesValue,u=a.inputPagesPerDayValue,m=a.datePrevision;if(""===i||""===s||s<=0||""===u||u<=0)t.showAlert("Por favor, preencha os campos marcados com *.","error",e,"beforeend");else{var v=new n(r,c,i,d,s,u,m);t.addBookToList(v),o.addBook(v),l(),location.reload(),t.showAlert("Livro adicionado!","success",e,"beforeend")}}},{key:"deleteBook",value:function(e){if(e.classList.contains("delete")){var a=document.querySelector('[data-book="bookId"]').innerText.substring(1);o.removeBook(a),e.parentElement.parentElement.parentElement.remove();var n=document.querySelector('[data-form="container"]');t.showAlert("Livro removido!","success",n,"afterend")}}},{key:"showAlert",value:function(e,t,a,o){var n=document.createElement("div");n.className="alert alert-".concat(t),n.appendChild(document.createTextNode(e)),a.insertAdjacentElement(o,n),setTimeout((function(){document.querySelector(".alert").remove()}),4e3)}},{key:"bookModalRender",value:function(e,t,a){t.id===+a?e.innerHTML=function(e){return'\n  <div class="modal" data-modalBookId="'.concat(e.id,'">\n    <div class="modal__book_cover">\n      <img src="').concat(e.cover||r,'" alt="').concat(e.title,'">\n    </div>\n\n    <div class="modal__book_info">\n      <span>').concat(e.author||"Autor não informado","</span>\n      <p>").concat(e.title,'</p>\n    </div>\n\n    <form class="modal__form" data-modal="form">\n      <fieldset>\n        <label for="currPag">Pág. Atual:*</label>\n        <input type="number" id="currPag" name="currPag" placeholder="').concat(e.currPag||e.pagesPerDay,'" data-modal="prevision">\n      </fieldset>\n      \n      <div>\n        <span>Pág. Total:*</span>\n        <p data-modal="totalPages">').concat(e.pagesTotal,'</p>\n      </div>\n    </form>\n\n    <div class="previsao">\n      <p>Previsão de término:</p>\n      <p class="data-prevista" data-modal="date">').concat(e.prevision,'</p>\n\n      <div class="progress">\n        <p data-modal="percentage">').concat(e.percentage||"0",'%</p>\n        <div class="progress__bar">\n        <span data-modal="progressBar" style="width:').concat(e.percentage,'%"></span>\n      </div>\n      </div>\n    </div>\n\n    <div class="form__btn">\n      <button class="btn btn--cancel cancel" data-modal="cancel">Cancelar</button>\n      <button class="btn btn--red confirm" data-modal="confirm">OK</button>\n    </div>\n  </div>\n')}(t):console.log("logica errada")}},{key:"bookUpdateModal",value:function(e,a,n){var r=document.querySelector("body");e.classList.contains("update")&&(a.style.display="grid",r.style.overflowY="hidden",o.getBooks().forEach((function(e){+e.id==+n&&t.bookModalRender(a,e,n)})))}},{key:"closeModal",value:function(e){var a=document.querySelector('[data-modal="container"]'),o=document.querySelector("body"),n=document.querySelector('[data-modal="form"]'),r=document.querySelector('[data-modal="prevision"]'),c=a.querySelector(".modal");(e.classList.contains("cancel")||e.classList.contains("backdrop"))&&(a.style.display="none",o.style.overflowY="scroll",n.reset()),""===r.value&&e.classList.contains("confirm")&&t.showAlert("Insira a página atual.","error",c,"beforeend"),""!==r.value&&e.classList.contains("confirm")&&(a.style.display="none",o.style.overflowY="scroll",n.reset())}},{key:"updateProgressBar",value:function(e,t){var a=document.getElementById(e),o=a.querySelector('[data-book="percentage"]'),n=a.querySelector('[data-book="progressBar"]');o.innerText="".concat(t,"%")||0,n.style.width="".concat(t,"%")}},{key:"updateProgressBarModal",value:function(e){var t=document.querySelector('[data-modal="progressBar"]'),a=document.querySelector('[data-modal="percentage"]');t.style.width="".concat(e,"%"),a.innerText=e>100?"100%":"".concat(e,"%")||0}},{key:"updateDate",value:function(e,t){document.getElementById(e).querySelector('[data-book="previsionDate"] span').innerText=t}},{key:"updateCurrPage",value:function(e,t){document.getElementById(e).querySelector('[data-book="currPage"]').innerText=t}}]),t}();m=document.querySelector('[data-form="btn"]'),v=document.querySelector('[data-form="imgPreview"]'),p=document.querySelector("#cover"),g=document.querySelector('[data-form="removeBtn"]'),f=document.querySelector('[data-book="list"]'),y=document.querySelector('[data-modal="container"]'),b=document.querySelector("#pagesPerDay"),k=o.getBooks(),p.addEventListener("change",(function(e){return t=e.target.files[0],a=new FileReader,void(t&&(a.addEventListener("load",(function(e){return t=e.target,a=document.querySelector(".fa-image"),(o=document.createElement("img")).src=t.result,a.style.display="none",o.dataset.image="preview",p.setAttribute("disabled",""),void v.appendChild(o);var t,a,o})),a.readAsDataURL(t)));var t,a})),g.addEventListener("click",(function(e){e.preventDefault(),l()})),y.addEventListener("click",(function(e){var t=e.target;t.classList.contains("confirm")&&(S.closeModal(t),k.forEach((function(e){e.currPag=u,e.percentage=i(e.currPag,e.pagesTotal),e.prevision=s.innerText,+d===e.id&&(o.updateBook(+d,e),S.updateProgressBar(e.id,e.percentage),S.updateDate(e.id,e.prevision),S.updateCurrPage(e.id,e.currPag),function(e){var t=document.querySelector('[data-bookItem="btn"]'),a=t.querySelector("button");if(100==+e.percentage){a.remove();var n=document.createElement("p");n.innerText="Concluído!",n.classList.add("completed_book"),t.insertAdjacentElement("afterbegin",n),o.getBooks().forEach((function(e){e.currPag>=100&&(e.completed=!0,o.updateBook(e.id,e))}))}}(e))})))})),f.addEventListener("click",(function(e){var t;e.preventDefault(),t=e.target,d=t.parentElement.parentElement.querySelector('[data-book="bookId"]').innerText.substring(1),S.bookUpdateModal(t,y,d),function(){var e=document.querySelector('[data-modal="prevision"]');s=document.querySelector('[data-modal="date"]');var t=document.querySelector('[data-modal="totalPages"]'),a=y.querySelector(".modal"),o=document.querySelector('[data-modal="confirm"]');s&&e.addEventListener("change",(function(e){var n=e.target;if(n.value>t.innerText||n.value<=0)S.showAlert("Página atual inválida.","error",a,"beforeend"),o.setAttribute("disabled",!0);else{o.removeAttribute("disabled"),s.innerText=c(t.innerText,n.value);var r=i(n.value,t.innerText);S.updateProgressBarModal(r),u=n.value,s=document.querySelector('[data-modal="date"]')}}))}(),S.deleteBook(e.target)})),y.addEventListener("click",(function(e){var t=e.target;S.closeModal(t)})),b.addEventListener("change",(function(e){var t,a;t=e.target,(a=document.querySelector("#totalPages").value)&&t.value&&(document.querySelector('[data-from="prevision"]').innerText=c(a,t.value))})),document.addEventListener("DOMContentLoaded",S.displayBooks),m.addEventListener("click",(function(e){e.preventDefault(),S.addBookData()}))})();
//# sourceMappingURL=index.js.map