(()=>{"use strict";function e(e,t){var a,o=new Date,n=(a=e/t,Math.floor(24*a*60*60));return o.setSeconds(o.getSeconds()+n),o.toLocaleDateString("pt-BR")}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,o){return t&&a(e.prototype,t),o&&a(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}var n=function(){function e(){t(this,e)}return o(e,null,[{key:"getBooks",value:function(){return null===localStorage.getItem("books")?[]:JSON.parse(localStorage.getItem("books"))}},{key:"addBook",value:function(t){var a=e.getBooks();a.push(t),localStorage.setItem("books",JSON.stringify(a))}},{key:"removeBook",value:function(t){var a=e.getBooks();a.forEach((function(e,o){+e.id==+t&&a.splice(o,1)})),localStorage.setItem("books",JSON.stringify(a))}},{key:"updateBook",value:function(t,a){var o=e.getBooks();o.forEach((function(e,n){e.id===t&&(o.splice(n,1),o.push(a)),localStorage.setItem("books",JSON.stringify(o))}))}}]),e}(),r=o((function e(a,o,n,r,c,l,d){t(this,e),this.id=a,this.cover=o,this.title=n,this.author=r,this.pagesTotal=c,this.pagesPerDay=l,this.prevision=d,this.completed=!1})),c=function(){function a(){t(this,a)}return o(a,null,[{key:"displayBooks",value:function(){n.getBooks().forEach((function(e){return a.addBookToList(e)}))}},{key:"addBookToList",value:function(e){var t=document.querySelector('[data-book="list"]'),o=document.createElement("article");o.setAttribute("id",e.id),o.classList.add("book_list__item"),o.innerHTML='\n      <div class="book_list__item__img">\n        <img src="'.concat(e.cover||"./assets/cover-undefined.png",'" alt="').concat(e.title,'">\n      </div>\n      <div class="book_list__item__info" data-book="info">\n        <h3>').concat(e.title,' <span class="book_id" data-book="bookId">#').concat(e.id,'</span></h3>\n        <p class="prevision" data-book="previsionDate">Previsão de término: <span>').concat(e.prevision,'</span></p>\n        <div class="progress">\n          <div class="progress__info">\n            <p class="pages"><span data-book="currPage">').concat(e.currPag||0,"\n              </span> páginas de ").concat(e.pagesTotal,'</p>\n            <p class="percentage" data-book="percentage">').concat(e.percentage||0,'%\n            </p>            \n          </div>\n          <div class="progress__bar">\n            <span data-book="progressBar"></span>\n          </div>\n        </div>  \n\n        <div class="book_list__item__btn" data-bookItem="btn">\n          ').concat(e.completed?'<p class="completed_book">Concluído</p>':'<button class="btn btn--red update" data-book="update">Atualizar</button>','\n          <i class="fa-solid fa-trash-can delete"></i>\n        </div>\n      </div>\n    '),o.dataset.book="item",t.insertAdjacentElement("afterbegin",o),a.updateProgressBar(e.id,e.percentage||0)}},{key:"getInputsValue",value:function(){var t,a=document.querySelector("#cover"),o=document.querySelector("#title").value,n=document.querySelector("#author").value,r=document.querySelector("#totalPages").value,c=document.querySelector("#pagesPerDay").value,l=null==a||null===(t=a.nextElementSibling)||void 0===t?void 0:t.attributes.src.nodeValue,d=e(r,c);return{id:Math.floor(9999999*Math.random()),imgBlob:l,inputTitleValue:o,inputAuthorValue:n,inputTotalPagesValue:r,inputPagesPerDayValue:c,datePrevision:d}}},{key:"addBookData",value:function(e){e.preventDefault();var t=document.querySelector('[data-form="container"]'),o=a.getInputsValue(),c=o.id,l=o.imgBlob,d=o.inputTitleValue,i=o.inputAuthorValue,s=o.inputTotalPagesValue,u=o.inputPagesPerDayValue,v=o.datePrevision;if(""===d||""===s||""===u)a.showAlert("Por favor, preencha os campos marcados com *.","error",t,"beforeend");else{var m=new r(c,l,d,i,s,u,v);a.addBookToList(m),n.addBook(m),a.clearInputFields(),a.showAlert("Livro adicionado!","success",t,"beforeend")}}},{key:"clearInputFields",value:function(){document.querySelector("#title").value="",document.querySelector("#author").value="",document.querySelector("#totalPages").value="",document.querySelector("#pagesPerDay").value="";var e=document.querySelector("#cover"),t=document.querySelector(".fa-image"),a=document.querySelector('[data-image="preview"]');a&&a.remove(),document.querySelector('[data-from="prevision"]').innerText="00/00/0000",t.style.display="block",e.removeAttribute("disabled")}},{key:"deleteBook",value:function(e){if(e.classList.contains("delete")){var t=document.querySelector('[data-book="bookId"]').innerText.substring(1);n.removeBook(t),e.parentElement.parentElement.parentElement.remove();var o=document.querySelector('[data-form="container"]');a.showAlert("Livro removido!","success",o,"afterend")}}},{key:"showAlert",value:function(e,t,a,o){var n=document.createElement("div");n.className="alert alert-".concat(t),n.appendChild(document.createTextNode(e)),a.insertAdjacentElement(o,n),setTimeout((function(){document.querySelector(".alert").remove()}),2e3)}},{key:"bookModalRender",value:function(e,t,a){t.id===+a?e.innerHTML=function(e){return'\n  <div class="modal" data-modalBookId="'.concat(e.id,'">\n    <div class="modal__book_cover">\n      <img src="').concat(e.cover||"./assets/cover-undefined.png",'" alt="').concat(e.title,'">\n    </div>\n\n    <div class="modal__book_info">\n      <span>').concat(e.author||"Autor não informado","</span>\n      <p>").concat(e.title,'</p>\n    </div>\n\n    <form class="modal__form" data-modal="form">\n      <fieldset>\n        <label for="currPag">Pág. Atual:*</label>\n        <input type="number" id="currPag" name="currPag" placeholder="').concat(e.currPag||e.pagesPerDay,'" data-modal="prevision">\n      </fieldset>\n      \n      <div>\n        <span>Pág. Total:*</span>\n        <p data-modal="totalPages">').concat(e.pagesTotal,'</p>\n      </div>\n    </form>\n\n    <div class="previsao">\n      <p>Previsão de término:</p>\n      <p class="data-prevista" data-modal="date">').concat(e.prevision,'</p>\n\n      <div class="progress">\n        <p data-modal="percentage">').concat(e.percentage||"0",'%</p>\n        <div class="progress__bar">\n        <span data-modal="progressBar" style="width:').concat(e.percentage,'%"></span>\n      </div>\n      </div>\n    </div>\n\n    <div class="form__btn">\n      <button class="btn btn--cancel cancel" data-modal="cancel">Cancelar</button>\n      <button class="btn btn--red confirm" data-modal="confirm">OK</button>\n    </div>\n  </div>\n')}(t):console.log("logica errada")}},{key:"bookUpdateModal",value:function(e,t,o){var r=document.querySelector("body");e.classList.contains("update")&&(t.style.display="grid",r.style.overflowY="hidden",n.getBooks().forEach((function(e){+e.id==+o&&a.bookModalRender(t,e,o)})))}},{key:"closeModal",value:function(e){var t=document.querySelector('[data-modal="container"]'),o=document.querySelector("body"),n=document.querySelector('[data-modal="form"]'),r=document.querySelector('[data-modal="prevision"]'),c=t.querySelector(".modal");(e.classList.contains("cancel")||e.classList.contains("backdrop"))&&(t.style.display="none",o.style.overflowY="scroll",n.reset()),""===r.value&&e.classList.contains("confirm")&&a.showAlert("Insira a página atual.","error",c,"beforeend"),""!==r.value&&e.classList.contains("confirm")&&(t.style.display="none",o.style.overflowY="scroll",n.reset())}},{key:"getPregressPerc",value:function(e,t){return(e/t*100).toFixed()}},{key:"updateProgressBar",value:function(e,t){var a=document.getElementById(e),o=a.querySelector('[data-book="percentage"]'),n=a.querySelector('[data-book="progressBar"]');o.innerText="".concat(t,"%")||0,n.style.width="".concat(t,"%")}},{key:"updateProgressBarModal",value:function(e){var t=document.querySelector('[data-modal="progressBar"]'),a=document.querySelector('[data-modal="percentage"]');t.style.width="".concat(e,"%"),a.innerText=e>100?"100%":"".concat(e,"%")||0}},{key:"updateDate",value:function(e,t){document.getElementById(e).querySelector('[data-book="previsionDate"] span').innerText=t}},{key:"updateCurrPage",value:function(e,t){document.getElementById(e).querySelector('[data-book="currPage"]').innerText=t}}]),a}();!function(){var t=document.querySelector('[data-form="btn"]');document.addEventListener("DOMContentLoaded",c.displayBooks),t.addEventListener("click",(function(e){return c.addBookData(e)}));var a,o,r,l=document.querySelector('[data-form="imgPreview"]'),d=document.querySelector("#cover"),i=document.querySelector('[data-form="removeBtn"]'),s=document.querySelector('[data-book="list"]'),u=document.querySelector('[data-modal="container"]'),v=document.querySelector("#pagesPerDay"),m=n.getBooks();d.addEventListener("change",(function(e){return t=e.target.files[0],a=new FileReader,void(t&&(a.addEventListener("load",(function(e){return t=e.target,a=document.querySelector(".fa-image"),(o=document.createElement("img")).src=t.result,a.style.display="none",o.dataset.image="preview",d.setAttribute("disabled",""),void l.appendChild(o);var t,a,o})),a.readAsDataURL(t)));var t,a})),i.addEventListener("click",(function(e){e.preventDefault(),c.clearInputFields()})),u.addEventListener("click",(function(e){var t=e.target;t.classList.contains("confirm")&&(c.closeModal(t),m.forEach((function(e){e.currPag=r,e.percentage=c.getPregressPerc(e.currPag,e.pagesTotal),e.prevision=o.innerText,+a===e.id&&(n.updateBook(+a,e),c.updateProgressBar(e.id,e.percentage),c.updateDate(e.id,e.prevision),c.updateCurrPage(e.id,e.currPag),function(e){var t=document.querySelector('[data-bookItem="btn"]'),a=t.querySelector("button");if(100==+e.percentage){a.remove();var o=document.createElement("p");o.innerText="Concluído!",o.classList.add("completed_book"),t.insertAdjacentElement("afterbegin",o),n.getBooks().forEach((function(e){e.completed=!0,n.updateBook(e.id,e)}))}}(e))})))})),s.addEventListener("click",(function(t){var n;t.preventDefault(),n=t.target,a=n.parentElement.parentElement.querySelector('[data-book="bookId"]').innerText.substring(1),c.bookUpdateModal(n,u,a),function(t){var a=document.querySelector('[data-modal="prevision"]');o=document.querySelector('[data-modal="date"]');var n=document.querySelector('[data-modal="totalPages"]'),l=u.querySelector(".modal"),d=document.querySelector('[data-modal="confirm"]');o&&a.addEventListener("change",(function(t){var a=t.target;if(a.value>n.innerText||a.value<=0)c.showAlert("Página atual inválida.","error",l,"beforeend"),d.setAttribute("disabled",!0);else{d.removeAttribute("disabled"),o.innerText=e(n.innerText,a.value),document.querySelector('[data-modal="progressBar"]');var i=c.getPregressPerc(a.value,n.innerText);c.updateProgressBarModal(i),r=a.value,o=document.querySelector('[data-modal="date"]')}}))}(),c.deleteBook(t.target)})),u.addEventListener("click",(function(e){var t=e.target;c.closeModal(t)})),v.addEventListener("change",(function(t){var a,o;a=t.target,(o=document.querySelector("#totalPages").value)&&a.value&&(document.querySelector('[data-from="prevision"]').innerText=e(o,a.value))}))}()})();
//# sourceMappingURL=index.js.map